# Spring Boot Coverage Boost Rules (Efficiency & Persistence Mode)

You are an expert Java developer. Goal: Increase total project LINE COVERAGE to 80% rapidly while preserving existing tests.

## 1. Mandatory Memory & State Persistence (CRITICAL)
- **Primary Source of Truth:** Always read `COVERAGE_PROGRESS.md` before starting.
- **Mandatory Update:** Immediately after any test passes, update `COVERAGE_PROGRESS.md` with:
    - Class Name
    - Lines of Code (LOC)
    - Current Line Coverage %
    - Status (Done/Pending)
- **Context Management:** Summarize the current state before ending a session to allow 128k context reset.

## 2. Prioritization Strategy: "The Biggest Fish First"
- **Size Priority:** Always identify and target classes with the **highest Lines of Code (LOC)** that have low coverage. Covering one 500-line class is more valuable than five 20-line classes.
- **Top-Down Impact:** Focus on Controllers and their associated Services. Integration tests at the Controller level yield the highest LOC coverage per test.

## 3. Testing Standards: Preservation + Expansion
- **Preserve Existing Tests:** - **DO NOT** modify or delete existing Mockito-based Unit Tests.
    - If a class already has a `*Test.java`, leave it.
- **New Coverage (IT Mode):** - Create **NEW** integration tests named `[ClassName]IT.java`.
    - Use `@SpringBootTest` + `@AutoConfigureMockMvc` + **H2 Database**.
    - Aim for the "Happy Path" to trigger as many lines as possible.
- **Metric:** Focus ONLY on **LINE COVERAGE**. Ignore complex branch logic unless required.
- **Mocks:** Use `@MockBean` ONLY for external 3rd-party APIs. Use real Beans for internal logic.

## 4. Technical Environment (Windows)
- **Java Home:** `C:\Program Files\Java\jdk-17`
- **Maven Command:** `$env:JAVA_HOME = "C:\Program Files\Java\jdk-17"; E:\maven-mvnd-1.0.3-windows-amd64\bin\mvnd.cmd clean test -Dtest=ClassName`

## 5. Execution Workflow
1. **Analyze (The LOC Scan):** Scan the project to find the largest classes (by line count) with the lowest coverage.
2. **Read:** Examine the target class and its existing tests.
3. **Draft IT:** Create a new `*IT.java` to cover the main execution paths of that large class.
4. **Verify:** Run the `mvnd` command.
5. **Report & Commit:** Update `COVERAGE_PROGRESS.md`, then git commit with a summary of the coverage gain.

## 6. Token Optimization
- Request only the necessary source code (target class + dependency signatures).
- Once a large class is covered, suggest starting a new chat session to refresh the 128k context.